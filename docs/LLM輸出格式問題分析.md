# LLM 輸出格式問題分析

## 問題描述

用戶反映 LLM 產出的內容無法像 Medium 網誌格式展示，雖然內容結構正確，但視覺呈現不夠像文章。

## 問題根源分析

### 1. **Markdown 格式問題**

從用戶提供的範例來看：
```
今日三句話（TL;DR）
穩定幣市場經歷波動，USX脫鉤事件揭示流動性管理的重要性。
2026年加密貨幣ETF市場預期大幅增長，吸引更多投資者進場。
科技、娛樂及硬體領域的創新持續升溫，市場需求日益多樣化。
```

**問題**：LLM 將「今日三句話」輸出為**段落形式**，而不是**列表形式**（`- `）。

**預期格式**（根據 prompt）：
```markdown
## 今日三句話（TL;DR）
- 穩定幣市場經歷波動，USX脫鉤事件揭示流動性管理的重要性。
- 2026年加密貨幣ETF市場預期大幅增長，吸引更多投資者進場。
- 科技、娛樂及硬體領域的創新持續升溫，市場需求日益多樣化。
```

### 2. **前端渲染問題**

#### 2.1 卡片式布局 vs 文章式布局

**當前實現**：
- 每個 H2 區塊成為獨立卡片
- 卡片有邊框、背景色、圓角
- 更像「卡片列表」而非「文章閱讀」

**Medium 風格**：
- 連續的文章流
- 大標題、段落間距、閱讀節奏
- 無明顯卡片邊界，更像長文閱讀

#### 2.2 段落樣式問題

**當前樣式**：
- 段落：`text-sm leading-6 mb-3`（14px，24px 行高，12px 下邊距）
- 標題：`text-lg font-semibold`（18px）

**Medium 風格**：
- 段落：更大字體（16-18px）、更寬行高（1.75-2.0）、更大段落間距
- 標題：更大字體（24-32px）、更明顯層級

### 3. **LLM Prompt 問題**

當前 prompt 要求：
```
## 今日三句話（TL;DR）
（用自然的口吻總結，不要用「首先、其次」，直接列出 3 個要點）
```

**問題**：沒有明確要求使用列表格式（`- `），導致 LLM 可能輸出段落。

## 解決方案

### 方案 1：修正 LLM Prompt（優先）

在 `backend/ai_service.py` 的 `generate_daily_briefing` 函數中，明確要求列表格式：

```python
## 今日三句話（TL;DR）
（用自然的口吻總結，不要用「首先、其次」，直接列出 3 個要點）
- [要點1：一句話描述]
- [要點2：一句話描述]
- [要點3：一句話描述]
```

### 方案 2：改進前端渲染樣式

#### 2.1 增加文章式布局選項

在 `MarkdownRenderer` 中：
- 為 TL;DR 區塊使用更寬鬆的段落樣式
- 增加段落間距（`mb-6` 而非 `mb-3`）
- 使用更大的字體（`text-base` 而非 `text-sm`）

#### 2.2 改進段落渲染

如果 LLM 輸出段落而非列表，前端可以：
- 自動檢測連續段落（無列表符號）
- 將連續段落渲染為更寬鬆的文章樣式
- 增加段落間距和行高

### 方案 3：後處理修正

在 `generate_daily_briefing` 函數返回前，檢查並修正格式：
- 如果「今日三句話」區塊是段落而非列表，自動轉換
- 確保所有區塊符合預期格式

## 具體修改建議

### 1. 修正 LLM Prompt

```python
## 今日三句話（TL;DR）
（用自然的口吻總結，不要用「首先、其次」，直接列出 3 個要點，**必須使用列表格式**）
- [要點1：一句話描述]
- [要點2：一句話描述]
- [要點3：一句話描述]
```

### 2. 改進 MarkdownRenderer 樣式

```jsx
// TL;DR 區塊使用更寬鬆的段落樣式
p: ({node, children, ...props}) => (
  <p className="
    text-slate-700 
    leading-7  // 增加行高（28px）
    mb-4      // 增加段落間距（16px）
    text-base // 更大字體（16px）
    text-left
  ">
    {children}
  </p>
),
```

### 3. 添加段落自動檢測

如果檢測到「今日三句話」區塊是連續段落，自動轉換為列表或使用特殊樣式。

## 測試建議

1. 檢查 LLM 實際輸出格式
2. 驗證前端渲染效果
3. 對比 Medium 文章樣式
4. 調整字體、行高、間距至最佳閱讀體驗

