# 🎯 設定完成後下一步指南

## ✅ 已完成

- [x] Firebase 專案已建立
- [x] Firestore Database 已設定
- [x] 服務帳號金鑰已下載
- [x] Railway 後端已設定

---

## 📋 下一步：設定前端（Vercel）

### 步驟 1: 獲取 Firebase 配置

1. 前往 [Firebase Console](https://console.firebase.google.com/)
2. 選擇您的專案（例如：`ai-news-aggregator`）
3. 點擊 ⚙️ **Project Settings**
4. 滾動到 **Your apps** 區塊
5. 如果沒有 Web app：
   - 點擊 **Add app** > 選擇 **Web** (</>)
   - 註冊 app（名稱：`ai-news-frontend`）
6. 複製 Firebase 配置（會顯示類似這樣的代碼）：

```javascript
const firebaseConfig = {
  apiKey: "AIzaSy...",
  authDomain: "ai-news-aggregator-xxxxx.firebaseapp.com",
  projectId: "ai-news-aggregator-xxxxx",  // ← 這個很重要！
  storageBucket: "ai-news-aggregator-xxxxx.appspot.com",
  messagingSenderId: "123456789",
  appId: "1:123456789:web:abc123..."
};
```

### 步驟 2: 設定 Vercel 環境變數

1. 前往 [Vercel Dashboard](https://vercel.com/dashboard)
2. 選擇專案 `ai-news-worker`
3. **Settings** > **Environment Variables**
4. 新增或更新以下變數：

| 變數名稱 | 值（從 Firebase 配置複製） |
|---------|------------------------|
| `VITE_FIREBASE_API_KEY` | `apiKey` 的值 |
| `VITE_FIREBASE_AUTH_DOMAIN` | `authDomain` 的值 |
| `VITE_FIREBASE_PROJECT_ID` | `projectId` 的值 ⚠️ **最重要** |
| `VITE_FIREBASE_STORAGE_BUCKET` | `storageBucket` 的值 |
| `VITE_FIREBASE_MESSAGING_SENDER_ID` | `messagingSenderId` 的值 |
| `VITE_FIREBASE_APP_ID` | `appId` 的值 |

**操作方式**：
- 點擊 **Add New**（新增）
- 輸入變數名稱和值
- 選擇環境：**Production, Preview, Development**（全部勾選）
- 點擊 **Save**（儲存）

### 步驟 3: 觸發重新部署

1. Vercel 會自動觸發重新部署（更新環境變數後）
2. 或手動觸發：
   - **Deployments** 標籤
   - 點擊最新部署的 "..." > **Redeploy**
3. 等待部署完成（約 1-2 分鐘）

---

## 📋 驗證步驟

### 驗證 1: 檢查 Railway 後端

1. 前往 [Railway Dashboard](https://railway.app/dashboard)
2. 選擇服務
3. **Logs** 標籤
4. 應該看到：
   ```
   ⏰ AI News Worker 排程器已啟動
   🧪 立即執行一次測試...
   🚀 開始執行每日任務：2025-12-26
   ```

**如果沒有看到執行記錄**：
- 檢查服務是否運行中
- 查看是否有錯誤訊息
- 確認排程器已啟動

### 驗證 2: 檢查 Firestore 資料

1. 前往 [Firebase Console](https://console.firebase.google.com/)
2. 選擇您的專案
3. **Firestore Database** > **Data** 標籤
4. 確認 `daily_news` collection 有文件
5. 確認文件 ID 是日期格式（例如：`2025-12-26`）
6. 確認文件包含 `content` 欄位

**如果沒有資料**：
- 等待後端執行完成（可能需要 5-10 分鐘）
- 檢查 Railway Logs 是否有錯誤
- 確認後端執行成功

### 驗證 3: 檢查前端配置

1. 等待 Vercel 部署完成
2. 打開網站 URL
3. 按 `F12` 打開開發者工具
4. 前往 **Console** 標籤
5. 應該看到：
   ```
   🔧 [Firebase] 配置檢查:
     - Project ID: ai-news-aggregator-xxxxx  ← 應該是新的專案 ID
   ✅ [Firebase] Firestore 已初始化
   🔍 [useNewsData] 開始讀取 Firestore...
   ```

**如果 Project ID 不正確**：
- 確認 Vercel 環境變數已更新
- 強制重新整理（Ctrl+Shift+R 或 Cmd+Shift+R）
- 確認部署已完成

### 驗證 4: 檢查資料讀取

1. 在 Console 中應該看到：
   ```
   📊 [useNewsData] 收到快照，文件數: 1  ← 應該 > 0
   ✅ [useNewsData] 成功載入 1 筆資料
   ```
2. 網站應該顯示日報內容

**如果還是顯示 `文件數: 0`**：
- 確認 Firestore 有資料（驗證 2）
- 確認 Project ID 一致（驗證 3）
- 確認 Firestore 規則允許讀取
- 查看 Console 中的錯誤訊息

---

## 🔍 完整檢查清單

### Firebase
- [ ] 專案已建立（名稱：`ai-news-aggregator`）
- [ ] Firestore Database 已建立
- [ ] Firestore 規則已設定（允許讀取）
- [ ] Web App 已註冊
- [ ] 服務帳號金鑰已下載

### Railway（後端）
- [ ] 服務運行中
- [ ] `SERVICE_ACCOUNT_KEY` 環境變數已設定
- [ ] `OPENAI_API_KEY` 環境變數已設定
- [ ] Logs 顯示排程器已啟動
- [ ] Logs 顯示執行成功

### Vercel（前端）
- [ ] 所有 `VITE_FIREBASE_*` 環境變數已設定
- [ ] `VITE_FIREBASE_PROJECT_ID` 與後端一致
- [ ] 部署已完成
- [ ] 網站可以訪問

### 資料流驗證
- [ ] Railway 後端執行成功
- [ ] Firestore 有資料（`daily_news` collection）
- [ ] 前端可以讀取資料
- [ ] 網站顯示日報內容

---

## 🎯 預期結果

完成所有步驟後應該：

1. ✅ **Railway Logs** 顯示：
   ```
   ✅ 任務成功！真實日報已存入: daily_news/2025-12-26
   ```

2. ✅ **Firestore** 有資料：
   - `daily_news/2025-12-26` 文件存在
   - 包含 `content` 欄位

3. ✅ **前端 Console** 顯示：
   ```
   - Project ID: ai-news-aggregator-xxxxx
   📊 [useNewsData] 收到快照，文件數: 1
   ✅ [useNewsData] 成功載入 1 筆資料
   ```

4. ✅ **網站顯示**：
   - 顯示最新日報內容
   - 格式正確
   - 沒有錯誤訊息

---

## 🆘 如果遇到問題

### 問題 1: Railway 後端沒有執行

**檢查**：
- 服務是否運行中
- Logs 是否有錯誤
- 環境變數是否正確

**解決**：
- 檢查 Railway Logs
- 確認 `SERVICE_ACCOUNT_KEY` 格式正確
- 確認 `OPENAI_API_KEY` 已設定

### 問題 2: Firestore 沒有資料

**檢查**：
- Railway Logs 是否顯示執行成功
- 是否有錯誤訊息

**解決**：
- 等待後端執行完成（可能需要 5-10 分鐘）
- 檢查 Railway Logs 中的錯誤
- 確認後端可以連接 Firebase

### 問題 3: 前端讀取不到資料

**檢查**：
- Console 中的 Project ID 是否正確
- Firestore 是否有資料
- Firestore 規則是否允許讀取

**解決**：
- 確認 Vercel 環境變數已更新
- 強制重新整理網站
- 確認前後端使用相同的 Project ID

### 問題 4: Project ID 不一致

**檢查**：
- 前端 Console 中的 Project ID
- 後端 `SERVICE_ACCOUNT_KEY` 中的 `project_id`
- Vercel 環境變數中的 `VITE_FIREBASE_PROJECT_ID`

**解決**：
- 確認前後端使用**相同的** Project ID
- 更新不一致的環境變數
- 重新部署

---

## 📝 下一步行動

### 立即行動

1. **設定 Vercel 環境變數**（步驟 1-3）
2. **等待部署完成**
3. **驗證所有檢查項目**

### 如果一切正常

1. ✅ 網站應該可以正常顯示日報
2. ✅ 後端會每天自動執行
3. ✅ 前端會自動更新最新內容

### 如果需要優化

參考 [架構與工作流優化建議](./架構與工作流優化建議.md) 進行進一步優化。

---

## 🎉 完成標誌

如果所有驗證都通過，恭喜！您的系統已經完全設定完成：

- ✅ 後端自動抓取和分析新聞
- ✅ 資料自動寫入 Firestore
- ✅ 前端自動顯示最新日報
- ✅ 系統完全自動化運行

---

**如果還有問題，請提供**：
1. Railway Logs（後端執行記錄）
2. Vercel Console 輸出（前端錯誤訊息）
3. Firestore 資料截圖（確認有資料）

我可以根據實際情況提供更具體的協助。

