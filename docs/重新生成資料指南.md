# 🔄 重新生成資料指南

## 問題說明

由於我們已經更新了：
1. **LLM Prompt** - 要求輸出新的 Markdown 格式（`## 標題`）
2. **前端渲染器** - 支持新的卡片樣式和置中排版

但是 **Firestore 中的舊資料**仍然是舊格式，所以前端顯示的還是舊樣式。

## ✅ 解決方案

### 方案 1: 等待自動執行（推薦）

Railway 的排程器會自動在每天執行，生成新格式的日報。

**優點**：無需手動操作  
**缺點**：需要等到下次執行時間

---

### 方案 2: 手動觸發 Railway 重新部署

1. 前往 [Railway Dashboard](https://railway.app)
2. 選擇您的專案
3. 點擊 **Deployments** 標籤
4. 找到最新的部署，點擊 **Redeploy** 或 **Deploy**
5. Railway 會重新啟動服務，`scheduler_continuous.py` 會立即執行一次

**優點**：可以立即看到效果  
**缺點**：需要手動操作

---

### 方案 3: 本地測試（開發用）

如果您想在本地測試新格式：

```bash
cd backend
python scheduler.py
```

這會立即執行一次完整的流程，生成新格式的日報並寫入 Firestore。

**注意**：需要確保本地環境變數已正確設定。

---

### 方案 4: 清除舊資料（可選）

如果您想立即看到新格式，可以：

1. 前往 [Firebase Console](https://console.firebase.google.com)
2. 選擇專案 `ai-news-aggregator`
3. 進入 **Firestore Database**
4. 找到 `daily_news` collection
5. 刪除舊的日報文件（例如 `2025-12-26`）

然後觸發重新執行（方案 2 或 3），生成新格式的日報。

---

## 📋 驗證步驟

執行後，檢查新生成的日報應該包含：

1. ✅ **正確的 Markdown 格式**：
   ```markdown
   ## 今日三句話（TL;DR）
   ## 📊 市場情緒儀表板
   ## 🌊 核心趨勢分析
   ## 🧭 決策指引
   ## 🔭 今日監測清單
   ## 📈 分類摘要
   ```

2. ✅ **前端顯示**：
   - 卡片式區塊標題（帶圖示和邊框）
   - 置中排版
   - TL;DR 特殊樣式
   - 監測清單顯示為 checkbox

---

## 🎯 推薦流程

1. **立即測試**：使用方案 2（Railway 重新部署）
2. **驗證效果**：檢查前端是否正確顯示新格式
3. **確認無誤**：之後可以依賴自動排程

---

## ⚠️ 注意事項

- 重新執行會消耗 OpenAI API 額度
- 如果今天已經執行過，新日報會覆蓋舊的（同一天）
- 確保 Railway 環境變數已正確設定

---

## 🔍 檢查新格式的方法

### 方法 1: 檢查 Firestore

1. 前往 Firebase Console
2. 查看 `daily_news` collection 中的最新文件
3. 檢查 `content` 欄位是否包含 `## ` 格式的標題

### 方法 2: 檢查前端

1. 重新整理網站
2. 檢查是否顯示：
   - 卡片式區塊
   - 置中排版
   - 圖示和邊框

---

## 📝 總結

**是的，需要重新執行後端來生成新格式的資料。**

最快的方法是：
1. 前往 Railway Dashboard
2. 重新部署服務
3. 等待執行完成（約 5-10 分鐘）
4. 重新整理前端網站查看效果

