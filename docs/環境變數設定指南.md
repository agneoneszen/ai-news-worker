# 🔧 環境變數設定指南

## 📋 概述

AI News Worker 需要以下環境變數才能正常運作：
- `OPENAI_API_KEY` - OpenAI API 金鑰（必需）
- Firebase 服務帳號金鑰（檔案形式，不是環境變數）

---

## 🚀 快速設定

### 步驟 1: 建立 .env 檔案

在 `backend/` 目錄下建立 `.env` 檔案：

```bash
cd backend
touch .env
```

### 步驟 2: 取得 OpenAI API Key

1. 前往 [OpenAI Platform](https://platform.openai.com/)
2. 登入您的帳號
3. 前往 **API Keys** 頁面
4. 點擊 **Create new secret key**
5. 複製產生的 API Key（格式：`sk-...`）

**重要**: API Key 只會顯示一次，請妥善保存。

### 步驟 3: 設定環境變數

#### 方法 1: 使用文字編輯器

```bash
cd backend
nano .env
# 或
code .env  # 使用 VS Code
```

在檔案中輸入：
```
OPENAI_API_KEY=sk-your-actual-api-key-here
```

**注意**: 
- 不要有引號
- 不要有多餘的空格
- `sk-` 後面是您的實際 API Key

#### 方法 2: 使用命令列

```bash
cd backend
echo "OPENAI_API_KEY=sk-your-actual-api-key-here" > .env
```

**替換**: 將 `sk-your-actual-api-key-here` 替換為您的實際 API Key

### 步驟 4: 驗證設定

```bash
cd backend
python3 check_setup.py
```

應該看到：
```
✅ OpenAI API Key: 已設定
```

---

## 🔍 驗證環境變數

### 方法 1: 檢查檔案內容

```bash
cd backend
cat .env
```

應該看到：
```
OPENAI_API_KEY=sk-...
```

**注意**: 不要顯示完整的 API Key 給他人看。

### 方法 2: 使用 Python 檢查

```bash
cd backend
python3 -c "import os; from dotenv import load_dotenv; load_dotenv(); print('API Key 已設定' if os.getenv('OPENAI_API_KEY') else 'API Key 未設定')"
```

### 方法 3: 執行檢查腳本

```bash
cd backend
python3 check_setup.py
```

---

## ⚠️ 常見錯誤

### 錯誤 1: 檔案不存在

**錯誤訊息**: `❌ OpenAI API Key 未設定`

**解決**:
```bash
cd backend
touch .env
echo "OPENAI_API_KEY=sk-..." >> .env
```

### 錯誤 2: 格式錯誤

**錯誤格式**:
```
OPENAI_API_KEY="sk-..."  # 有引號
OPENAI_API_KEY = sk-...  # 有空格
```

**正確格式**:
```
OPENAI_API_KEY=sk-...
```

### 錯誤 3: API Key 無效

**錯誤訊息**: API 呼叫失敗

**解決**:
1. 確認 API Key 正確（從 OpenAI Platform 複製）
2. 確認 API Key 未過期
3. 確認帳號有足夠的配額

### 錯誤 4: 檔案位置錯誤

**錯誤**: `.env` 檔案放在錯誤的位置

**正確位置**:
```
ai-news-worker/
└── backend/
    └── .env  ✅ 正確位置
```

**錯誤位置**:
```
ai-news-worker/
├── .env  ❌ 錯誤位置（應該在 backend/）
└── backend/
```

---

## 🔐 安全注意事項

1. **不要提交到 Git**
   - `.env` 已加入 `.gitignore`
   - 不要將 API Key 提交到版本控制

2. **不要分享 API Key**
   - API Key 就像密碼
   - 不要分享給他人
   - 不要在公開場合顯示

3. **定期輪換**
   - 如果懷疑 API Key 洩露
   - 立即在 OpenAI Platform 撤銷
   - 產生新的 API Key

4. **使用環境變數（生產環境）**
   - 在 Railway/Vercel 等平台
   - 使用環境變數設定，不要使用檔案

---

## 📝 完整設定範例

### 本地開發 (.env 檔案)

```bash
# backend/.env
OPENAI_API_KEY=sk-proj-abc123def456ghi789jkl012mno345pqr678stu901vwx234yz
```

### 生產環境 (Railway)

在 Railway Dashboard:
1. 前往 **Variables** 標籤
2. 新增變數：
   - Key: `OPENAI_API_KEY`
   - Value: `sk-...`（您的 API Key）

### 生產環境 (Vercel)

在 Vercel Dashboard:
1. 前往 **Settings** > **Environment Variables**
2. 新增變數：
   - Key: `OPENAI_API_KEY`
   - Value: `sk-...`（您的 API Key）

---

## 🧪 測試設定

設定完成後，執行測試：

```bash
cd backend

# 1. 檢查環境
python3 check_setup.py

# 2. 測試 AI 分析
python3 test_ai_only.py

# 3. 完整測試
./run_local.sh
```

---

## 🔗 相關資源

- [OpenAI Platform](https://platform.openai.com/)
- [OpenAI API 文件](https://platform.openai.com/docs)
- [API Key 管理](https://platform.openai.com/api-keys)

---

## ❓ 常見問題

### Q: 如何取得 OpenAI API Key？

A: 
1. 前往 https://platform.openai.com/
2. 登入帳號
3. API Keys > Create new secret key
4. 複製產生的 Key

### Q: API Key 需要付費嗎？

A: 
- OpenAI API 是付費服務
- 有免費試用額度（新帳號）
- 使用後按用量計費

### Q: 可以共用 API Key 嗎？

A: 
- 不建議共用
- 每個開發者應該有自己的 Key
- 方便追蹤使用量和成本

### Q: API Key 會過期嗎？

A: 
- API Key 不會自動過期
- 但可以手動撤銷
- 建議定期檢查和輪換

