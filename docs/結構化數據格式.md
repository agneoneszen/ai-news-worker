# 結構化數據格式說明

## 概述

從現在開始，Firebase 會同時儲存：
1. **`content`** - 原始 Markdown 格式（向後兼容）
2. **`structured`** - 結構化的數據格式（新功能）

## 結構化數據格式

```typescript
{
  tldr: string[],                    // 今日三句話
  sentiment: {                       // 市場情緒儀表板
    mood?: string,                   // 情緒
    hot_words?: string[],           // 熱詞
    capital_factor?: string,        // 資金主導因子
    regulatory_factor?: string,     // 監管主導因子
    security_factor?: string        // 資安主導因子
  },
  trends: Array<{                    // 核心趨勢分析
    title: string,                   // 趨勢標題
    description: string              // 趨勢描述
  }>,
  decisions: {                       // 決策指引
    investment: string[],           // 投資/交易
    product: string[],              // 產品/工程
    operations: string[]            // 營運/風控
  },
  monitoring: Array<{                // 今日監測清單
    checked: boolean,                // 是否已勾選
    text: string                     // 監測項目文字
  }>,
  categories: Array<{                // 分類摘要
    name: string,                    // 分類名稱
    items: string[],                 // 要點列表
    confidence: number               // 信心度 (0.0-1.0)
  }>,
  uncertainties: string[],           // 不確定性與反方觀點
  sources: {                         // 資訊來源
    [category: string]: Array<{      // 按分類組織
      title: string,                  // 文章標題
      url: string,                    // 文章 URL
      source: string                  // 來源名稱
    }>
  }
}
```

## 使用範例

### 前端使用結構化數據

```javascript
// 在 NewsCard 組件中
const { news } = useNewsData();

news.forEach(item => {
  if (item.structured) {
    // 使用結構化數據
    const tldr = item.structured.tldr;
    const sentiment = item.structured.sentiment;
    const trends = item.structured.trends;
    // ...
  } else {
    // 向後兼容：使用原始 Markdown
    const content = item.content;
  }
});
```

### 渲染「今日三句話」

```jsx
{item.structured?.tldr && (
  <section>
    <h2>今日三句話（TL;DR）</h2>
    <ul>
      {item.structured.tldr.map((point, i) => (
        <li key={i}>{point}</li>
      ))}
    </ul>
  </section>
)}
```

### 渲染「市場情緒儀表板」

```jsx
{item.structured?.sentiment && (
  <section>
    <h2>市場情緒儀表板</h2>
    <div>
      <p>情緒：{item.structured.sentiment.mood}</p>
      <p>熱詞：{item.structured.sentiment.hot_words?.join('、')}</p>
      <p>資金主導因子：{item.structured.sentiment.capital_factor}</p>
      {/* ... */}
    </div>
  </section>
)}
```

## 優勢

1. **更靈活的渲染**：可以針對不同區塊使用不同的組件和樣式
2. **無需解析 Markdown**：直接使用結構化數據
3. **更好的類型安全**：可以定義 TypeScript 類型
4. **向後兼容**：仍保留 `content` 欄位，舊代碼仍可運作

## 下一步

前端可以：
1. 優先使用 `structured` 數據
2. 如果沒有 `structured`，回退到 `content`（Markdown）
3. 為每個區塊創建專門的組件
4. 實現更精細的樣式控制

