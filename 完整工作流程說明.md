# ğŸ”„ AI News Worker å®Œæ•´å·¥ä½œæµç¨‹

## ğŸ“Š ç³»çµ±æ¶æ§‹æ¦‚è¦½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   RSS ä¾†æº   â”‚ â”€â”€â”€> â”‚  å¾Œç«¯æœå‹™    â”‚ â”€â”€â”€> â”‚  Firestore  â”‚
â”‚ The Verge   â”‚      â”‚  (Railway/   â”‚      â”‚  è³‡æ–™åº«      â”‚
â”‚ CoinDesk    â”‚      â”‚   Render)    â”‚      â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚                       â”‚
                            â”‚ AI åˆ†æ               â”‚
                            â”‚ OpenAI GPT            â”‚
                            â”‚                       â”‚
                            v                       v
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚  ç”Ÿæˆæ—¥å ±     â”‚ â”€â”€â”€> â”‚   å‰ç«¯ç¶²ç«™   â”‚
                     â”‚  Markdown    â”‚      â”‚   (Vercel)   â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” è©³ç´°å·¥ä½œæµç¨‹

### éšæ®µ 1: è³‡æ–™æŠ“å–ï¼ˆData Scrapingï¼‰

**æª”æ¡ˆ**: `backend/scraper.py`

#### æ­¥é©Ÿ 1.1: åˆå§‹åŒ– RSS ä¾†æº

```python
RSS_FEEDS = [
    {
        "source": "The Verge",
        "url": "https://www.theverge.com/rss/index.xml",
        "category": "Tech"
    },
    {
        "source": "CoinDesk",
        "url": "https://www.coindesk.com/arc/outboundfeeds/rss/",
        "category": "Crypto"
    }
]
```

#### æ­¥é©Ÿ 1.2: æŠ“å– RSS Feed

1. **éæ­·æ¯å€‹ RSS ä¾†æº**
   ```python
   for feed_info in RSS_FEEDS:
       feed = feedparser.parse(feed_info['url'])
   ```

2. **é©—è­‰ Feed æœ‰æ•ˆæ€§**
   - æª¢æŸ¥ `feed.bozo`ï¼ˆå¦‚æœç‚º 1 è¡¨ç¤ºè§£æéŒ¯èª¤ï¼‰
   - å¦‚æœéŒ¯èª¤ï¼Œè·³éè©²ä¾†æº

3. **æå–æ–°èé …ç›®**
   - åªå–å‰ 5 ç¯‡ï¼ˆé¿å…è³‡æ–™éèˆŠï¼‰
   - å¾æ¯å€‹ entry æå–ï¼š
     - `title`: æ–°èæ¨™é¡Œ
     - `link`: æ–°èé€£çµ
     - `content` æˆ– `summary`: æ–°èå…§å®¹
     - `published`: ç™¼å¸ƒæ™‚é–“

#### æ­¥é©Ÿ 1.3: æ¸…ç†å’Œæ ¼å¼åŒ–

1. **æ¸…ç† HTML æ¨™ç±¤**
   ```python
   clean_content = re.sub('<[^<]+?>', '', content)[:1000]
   ```
   - ç§»é™¤æ‰€æœ‰ HTML æ¨™ç±¤
   - é™åˆ¶é•·åº¦ç‚º 1000 å­—å…ƒ

2. **å»ºç«‹æ–°èç‰©ä»¶**
   ```python
   news_item = {
       "title": entry.title,
       "url": entry.link,
       "content": clean_content,
       "source": feed_info['source'],
       "published_at": entry.get('published', ...),
       "category": feed_info['category']
   }
   ```

3. **ç¦®è²Œæ€§å»¶é²**
   ```python
   time.sleep(1)  # é¿å…è¢«ç¶²ç«™é˜»æ“‹
   ```

#### æ­¥é©Ÿ 1.4: è¿”å›çµæœ

- **æˆåŠŸ**: è¿”å›æ–°èåˆ—è¡¨ `news_list`
- **å¤±æ•—**: è¿”å›ç©ºåˆ—è¡¨ `[]`ï¼ˆçµ•å°ä¸å›å‚³å‡è³‡æ–™ï¼‰

---

### éšæ®µ 2: AI åˆ†æï¼ˆAI Analysisï¼‰

**æª”æ¡ˆ**: `backend/ai_service.py`

#### æ­¥é©Ÿ 2.1: å–®ç¯‡æ–°èåˆ†æ

**å‡½æ•¸**: `analyze_article(text)`

1. **æº–å‚™è¼¸å…¥**
   ```python
   input_text = text[:2500]  # é™åˆ¶ç‚º 2500 å­—å…ƒ
   ```

2. **è¨­å®š AI æç¤ºè©**
   ```python
   system_prompt = """
   ä½ æ˜¯ä¸€ä½ç¹é«”ä¸­æ–‡çš„è³‡æ·±ç§‘æŠ€ç”¢æ¥­åˆ†æå¸«ã€‚
   é–±è®€ã€æ–°èå…§å®¹ã€‘ï¼Œå›å‚³ä»¥ä¸‹ JSON æ ¼å¼ï¼š
   {
     "summary": "æ•˜è¿°æ€§æ‘˜è¦(ç¹é«”ä¸­æ–‡)",
     "highlights": "<li><b>é‡é»1ï¼š</b>å…§å®¹</li>...",
     "category": "åˆ†é¡(å¦‚:äººå·¥æ™ºæ…§,å€å¡Šéˆ,ç¡¬é«”,å•†æ¥­,è³‡å®‰)",
     "insight": "ä¸€å¥è©±ç”¢æ¥­æ·±åº¦æ´å¯Ÿ"
   }
   """
   ```

3. **å‘¼å« OpenAI API**
   ```python
   response = client.chat.completions.create(
       model="gpt-4o-mini",
       messages=[
           {"role": "system", "content": system_prompt},
           {"role": "user", "content": input_text}
       ],
       temperature=0.3,
       response_format={"type": "json_object"}
   )
   ```

4. **è§£æçµæœ**
   ```python
   return json.loads(response.choices[0].message.content)
   ```

#### æ­¥é©Ÿ 2.2: æ‰¹é‡è™•ç†

åœ¨ `scheduler.py` ä¸­ï¼š

```python
for news in raw_news_list:
    analysis_result = analyze_article(news.get("content", ""))
    if analysis_result:
        processed_news = {**news, **analysis_result}
        processed_articles.append(processed_news)
```

**åˆä½µçµæœ**:
- åŸå§‹æ–°èè³‡æ–™ + AI åˆ†æçµæœ
- åŒ…å«ï¼štitle, url, content, source, category, summary, highlights, insight

---

### éšæ®µ 3: ç”Ÿæˆæ¯æ—¥æ±ºç­–æ—¥å ±ï¼ˆDaily Briefing Generationï¼‰

**æª”æ¡ˆ**: `backend/ai_service.py`  
**å‡½æ•¸**: `generate_daily_briefing(articles_data)`

#### æ­¥é©Ÿ 3.1: æ•´ç†è³‡æ–™

```python
input_text = ""
for a in articles_data:
    category = a.get('category', 'æœªåˆ†é¡')
    title = a.get('title', 'ç„¡æ¨™é¡Œ')
    insight = a.get('insight', 'ç„¡æ´å¯Ÿ')
    input_text += f"- [{category}] {title} (Insight: {insight})\n"
```

#### æ­¥é©Ÿ 3.2: å‘¼å« AI ç”Ÿæˆæ—¥å ±

```python
system_prompt = """
ä½ æ˜¯ä¸€ä½åŠ å¯†è²¨å¹£èˆ‡ç§‘æŠ€ç”¢æ¥­çš„ã€é¦–å¸­ç­–ç•¥å®˜ã€‘ã€‚
è«‹æ ¹æ“šæä¾›çš„æ–°èæ¸…å–®ï¼Œæ’°å¯«ä¸€ä»½ Markdown æ ¼å¼çš„ã€æ¯æ—¥æ±ºç­–æ—¥å ±ã€‘ã€‚
çµæ§‹å¦‚ä¸‹ï¼š
### ğŸ“Š å¸‚å ´æƒ…ç·’å„€è¡¨æ¿
(åˆ¤æ–·æ•´é«”æ°£æ°›èˆ‡é—œéµç†±è©)
### ğŸŒŠ ä¸‰å¤§æ ¸å¿ƒè¶¨å‹¢
(æ­¸ç´ä»Šæ—¥æœ€é‡è¦çš„ä¸‰æ¢æ•…äº‹ç·š)
### ğŸ§­ æ±ºç­–å»ºè­°
(çµ¦é–‹ç™¼è€…èˆ‡æŠ•è³‡è€…çš„å…·é«”å»ºè­°)
"""

response = client.chat.completions.create(
    model="gpt-4o-mini",
    messages=[
        {"role": "system", "content": system_prompt},
        {"role": "user", "content": f"ã€ä»Šæ—¥æƒ…å ±ã€‘\n{input_text}"}
    ],
    temperature=0.5
)
```

#### æ­¥é©Ÿ 3.3: è¿”å› Markdown æ ¼å¼æ—¥å ±

è¿”å›å®Œæ•´çš„ Markdown æ–‡å­—ï¼ŒåŒ…å«ï¼š
- å¸‚å ´æƒ…ç·’å„€è¡¨æ¿
- ä¸‰å¤§æ ¸å¿ƒè¶¨å‹¢
- æ±ºç­–å»ºè­°

---

### éšæ®µ 4: è³‡æ–™å„²å­˜ï¼ˆData Storageï¼‰

**æª”æ¡ˆ**: `backend/scheduler.py`

#### æ­¥é©Ÿ 4.1: åˆå§‹åŒ– Firestore

```python
# å¾ç’°å¢ƒè®Šæ•¸æˆ–æª”æ¡ˆè®€å–æœå‹™å¸³è™Ÿé‡‘é‘°
if os.getenv("SERVICE_ACCOUNT_KEY"):
    cred_dict = json.loads(os.getenv("SERVICE_ACCOUNT_KEY"))
    cred = credentials.Certificate(cred_dict)
else:
    cred = credentials.Certificate("serviceAccountKey.json")

firebase_admin.initialize_app(cred)
db = firestore.client()
```

#### æ­¥é©Ÿ 4.2: æº–å‚™è³‡æ–™çµæ§‹

```python
today_str = datetime.datetime.now().strftime("%Y-%m-%d")  # ä¾‹å¦‚: "2025-12-26"

data = {
    'date_str': today_str,
    'content': daily_briefing_md,  # Markdown æ ¼å¼çš„æ—¥å ±
    'article_count': len(processed_articles),  # åˆ†æçš„æ–°èæ•¸é‡
    'tags': list(set([a['category'] for a in processed_articles])),  # å»é‡å¾Œçš„é¡åˆ¥æ¨™ç±¤
    'created_at': firestore.SERVER_TIMESTAMP,  # ä¼ºæœå™¨æ™‚é–“æˆ³
    'status': 'published'  # ç™¼å¸ƒç‹€æ…‹
}
```

#### æ­¥é©Ÿ 4.3: å¯«å…¥ Firestore

```python
db.collection('daily_news').document(today_str).set(data)
```

**è³‡æ–™çµæ§‹**:
```
Firestore
â””â”€â”€ daily_news (collection)
    â”œâ”€â”€ 2025-12-26 (document ID = æ—¥æœŸ)
    â”‚   â”œâ”€â”€ date_str: "2025-12-26"
    â”‚   â”œâ”€â”€ content: "# æ¯æ—¥æ±ºç­–æ—¥å ±\n\n### ğŸ“Š å¸‚å ´æƒ…ç·’..."
    â”‚   â”œâ”€â”€ article_count: 10
    â”‚   â”œâ”€â”€ tags: ["äººå·¥æ™ºæ…§", "å€å¡Šéˆ", "ç¡¬é«”"]
    â”‚   â”œâ”€â”€ created_at: Timestamp
    â”‚   â””â”€â”€ status: "published"
    â”œâ”€â”€ 2025-12-27
    â””â”€â”€ ...
```

**é‡è¦ç‰¹æ€§**:
- **Document ID = æ—¥æœŸå­—ä¸²**: æ¯å¤©åªæœ‰ä¸€ä»½æ—¥å ±
- **è‡ªå‹•è¦†è“‹**: å¦‚æœåŒä¸€å¤©åŸ·è¡Œå¤šæ¬¡ï¼Œæœƒè¦†è“‹èˆŠè³‡æ–™
- **å³æ™‚åŒæ­¥**: Firestore æ”¯æ´å³æ™‚ç›£è½ï¼Œå‰ç«¯æœƒè‡ªå‹•æ›´æ–°

---

### éšæ®µ 5: å‰ç«¯é¡¯ç¤ºï¼ˆFrontend Displayï¼‰

**æª”æ¡ˆ**: `frontend/src/hooks/useNewsData.js`

#### æ­¥é©Ÿ 5.1: é€£ç·š Firestore

```javascript
import { db } from '../firebase';
import { collection, query, onSnapshot, limit } from 'firebase/firestore';

const q = query(
    collection(db, "daily_news"),
    limit(5)  // åªå–æœ€æ–° 5 ç¯‡
);
```

#### æ­¥é©Ÿ 5.2: å³æ™‚ç›£è½

```javascript
const unsubscribe = onSnapshot(q, (snapshot) => {
    const newsData = snapshot.docs.map(doc => ({
        id: doc.id,  // æ—¥æœŸå­—ä¸²
        date_str: doc.data().date_str || doc.id,
        ...doc.data()  // åŒ…å«æ‰€æœ‰æ¬„ä½
    }));
    setNews(newsData);
});
```

**å³æ™‚æ›´æ–°æ©Ÿåˆ¶**:
- `onSnapshot` æœƒç›£è½ Firestore çš„è®Šæ›´
- ç•¶å¾Œç«¯å¯«å…¥æ–°è³‡æ–™æ™‚ï¼Œå‰ç«¯æœƒè‡ªå‹•æ”¶åˆ°é€šçŸ¥
- ç„¡éœ€æ‰‹å‹•é‡æ–°æ•´ç†é é¢

#### æ­¥é©Ÿ 5.3: é¡¯ç¤ºå…§å®¹

**æª”æ¡ˆ**: `frontend/src/components/NewsCard.jsx`

```javascript
<ReactMarkdown>
    {data.content || "æš«ç„¡å ±å‘Šå…§å®¹"}
</ReactMarkdown>
```

- ä½¿ç”¨ `react-markdown` æ¸²æŸ“ Markdown æ ¼å¼
- é¡¯ç¤ºæ—¥æœŸã€æ¨™ç±¤ã€æ–‡ç« æ•¸é‡ç­‰è³‡è¨Š

---

## â° æ’ç¨‹åŸ·è¡Œ

**æª”æ¡ˆ**: `backend/scheduler_continuous.py`

### æ’ç¨‹è¨­å®š

```python
schedule.every().day.at("09:00").do(job_pipeline)  # æ¯å¤© 09:00 UTC åŸ·è¡Œ
```

### ä¸»å¾ªç’°

```python
while True:
    schedule.run_pending()  # æª¢æŸ¥æ˜¯å¦æœ‰æ’ç¨‹éœ€è¦åŸ·è¡Œ
    time.sleep(60)  # æ¯åˆ†é˜æª¢æŸ¥ä¸€æ¬¡
```

### åŸ·è¡Œæµç¨‹

1. **09:00 UTC** - è§¸ç™¼ `job_pipeline()`
2. **æŠ“å–æ–°è** - å¾ RSS ä¾†æºæŠ“å–
3. **AI åˆ†æ** - é€ç¯‡åˆ†æ
4. **ç”Ÿæˆæ—¥å ±** - å½™æ•´æ‰€æœ‰åˆ†æ
5. **å¯«å…¥ Firestore** - å„²å­˜çµæœ
6. **ç­‰å¾…ä¸‹æ¬¡åŸ·è¡Œ** - ç¹¼çºŒé‹è¡Œç›´åˆ°ä¸‹æ¬¡ 09:00

---

## ğŸ“Š è³‡æ–™æµç¨‹åœ–

```
1. æ’ç¨‹è§¸ç™¼ (09:00 UTC)
   â”‚
   â”œâ”€> 2. æŠ“å– RSS Feed
   â”‚   â”œâ”€> The Verge (Tech æ–°è)
   â”‚   â””â”€> CoinDesk (Crypto æ–°è)
   â”‚
   â”œâ”€> 3. æ¸…ç†å’Œæ ¼å¼åŒ–
   â”‚   â””â”€> ç§»é™¤ HTMLï¼Œé™åˆ¶é•·åº¦
   â”‚
   â”œâ”€> 4. AI åˆ†æï¼ˆé€ç¯‡ï¼‰
   â”‚   â”œâ”€> OpenAI GPT-4o-mini
   â”‚   â”œâ”€> æå–ï¼šsummary, highlights, category, insight
   â”‚   â””â”€> åˆä½µåˆ°åŸå§‹æ–°èè³‡æ–™
   â”‚
   â”œâ”€> 5. ç”Ÿæˆæ¯æ—¥æ±ºç­–æ—¥å ±
   â”‚   â”œâ”€> OpenAI GPT-4o-mini
   â”‚   â””â”€> Markdown æ ¼å¼
   â”‚
   â”œâ”€> 6. å¯«å…¥ Firestore
   â”‚   â”œâ”€> Collection: daily_news
   â”‚   â”œâ”€> Document ID: æ—¥æœŸ (2025-12-26)
   â”‚   â””â”€> åŒ…å«ï¼šcontent, article_count, tags, created_at
   â”‚
   â””â”€> 7. å‰ç«¯è‡ªå‹•æ›´æ–°
       â”œâ”€> Firestore å³æ™‚ç›£è½
       â””â”€> é¡¯ç¤ºæœ€æ–°æ—¥å ±
```

---

## ğŸ” å®‰å…¨æ©Ÿåˆ¶

### 1. è³‡æ–™é©—è­‰

- **ç©ºè³‡æ–™æª¢æŸ¥**: å¦‚æœæŠ“å–å¤±æ•—ï¼Œä¸å¯«å…¥ä»»ä½•è³‡æ–™
- **æ ¼å¼é©—è­‰**: AI å›æ‡‰å¿…é ˆæ˜¯æœ‰æ•ˆçš„ JSON
- **éŒ¯èª¤è™•ç†**: ä»»ä½•æ­¥é©Ÿå¤±æ•—éƒ½æœƒè¨˜éŒ„ä¸¦è·³é

### 2. ç’°å¢ƒè®Šæ•¸ä¿è­·

- **æœå‹™å¸³è™Ÿé‡‘é‘°**: é€éç’°å¢ƒè®Šæ•¸å‚³éï¼Œä¸å¯«åœ¨ç¨‹å¼ç¢¼ä¸­
- **API Keys**: å„²å­˜åœ¨å¹³å°ç’°å¢ƒè®Šæ•¸ä¸­

### 3. Firestore è¦å‰‡

å»ºè­°è¨­å®š Firestore è¦å‰‡ï¼š
```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /daily_news/{document=**} {
      allow read: if true;  // æ‰€æœ‰äººéƒ½å¯ä»¥è®€å–
      allow write: if false;  // åªæœ‰å¾Œç«¯å¯ä»¥å¯«å…¥ï¼ˆé€éæœå‹™å¸³è™Ÿï¼‰
    }
  }
}
```

---

## ğŸ“ˆ æ•ˆèƒ½å„ªåŒ–

### 1. é™åˆ¶è³‡æ–™é‡

- RSS Feed: åªå–å‰ 5 ç¯‡
- å…§å®¹é•·åº¦: é™åˆ¶ç‚º 1000-2500 å­—å…ƒ
- å‰ç«¯é¡¯ç¤º: åªå–æœ€æ–° 5 ç¯‡

### 2. éŒ¯èª¤è™•ç†

- å–®ç¯‡åˆ†æå¤±æ•—ä¸å½±éŸ¿æ•´é«”
- å¦‚æœæ‰€æœ‰åˆ†æå¤±æ•—ï¼Œä¸ç”Ÿæˆæ—¥å ±
- è¨˜éŒ„æ‰€æœ‰éŒ¯èª¤ä»¥ä¾¿é™¤éŒ¯

### 3. æˆæœ¬æ§åˆ¶

- ä½¿ç”¨ `gpt-4o-mini`ï¼ˆè¼ƒä¾¿å®œçš„æ¨¡å‹ï¼‰
- é™åˆ¶è¼¸å…¥é•·åº¦
- æ¯å¤©åªåŸ·è¡Œä¸€æ¬¡

---

## ğŸ¯ ç¸½çµ

**å®Œæ•´æµç¨‹**:
1. **æŠ“å–** â†’ RSS Feed â†’ æ¸…ç† â†’ æ ¼å¼åŒ–
2. **åˆ†æ** â†’ OpenAI â†’ æå–æ´å¯Ÿ â†’ åˆ†é¡
3. **ç”Ÿæˆ** â†’ å½™æ•´åˆ†æ â†’ ç”Ÿæˆæ—¥å ± â†’ Markdown
4. **å„²å­˜** â†’ Firestore â†’ æ—¥æœŸç‚º ID â†’ å³æ™‚åŒæ­¥
5. **é¡¯ç¤º** â†’ å‰ç«¯ç›£è½ â†’ è‡ªå‹•æ›´æ–° â†’ æ¸²æŸ“ Markdown

**é—œéµç‰¹æ€§**:
- âœ… è‡ªå‹•åŒ–ï¼šæ¯å¤©è‡ªå‹•åŸ·è¡Œ
- âœ… å³æ™‚æ€§ï¼šå‰ç«¯è‡ªå‹•æ›´æ–°
- âœ… å¯é æ€§ï¼šéŒ¯èª¤è™•ç†å®Œå–„
- âœ… å¯æ“´å±•ï¼šæ˜“æ–¼æ–°å¢æ–°èä¾†æº

